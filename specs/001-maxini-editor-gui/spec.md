# Feature Specification: MaxINI Editor GUI

**Feature Branch**: `001-maxini-editor-gui`  
**Created**: 2025-10-17  
**Status**: Draft  
**GitHub Issue**: #10  
**Input**: User description: "создать графическую оболочку для редактирования max.ini в 3ds Max с предустановками, пресетами и подсказками на русском и английском языках, считывание, сохранение, применение предустановок"

## Clarifications

### Session 2025-10-17

- Q: Каким способом пользователь открывает MaxINI Editor? → A: Макрос в 3ds Max запускает Python скрипт с Qt GUI (PySide6). UI на Qt/Python, запуск через макрос MaxScript. Переиспользуем инфраструктуру MaxManager (PySide6, theme_loader, config).

- Q: Как обрабатываем конфликты при одновременном редактировании max.ini? → A: **ЭКСПЕРИМЕНТ В ПРОЦЕССЕ**. Создан тестовый прототип `MaxManager_INIEditor_Test.ms` для проверки поведения max.ini. План: 1) Найти max.ini, 2) Прочитать содержимое, 3) Сделать тестовое изменение, 4) Проверить перезаписывает ли 3ds Max файл обратно. Результаты эксперимента определят финальную архитектуру (перезапуск Max обязателен VS можно применить на лету).

- Q: Откуда берём параметры для встроенных пресетов (High Performance, Memory Optimized, Arnold, V-Ray, Minimal)? → A: Исследуем документацию Autodesk + форумы и community (CGSociety, Autodesk forums, Reddit r/3dsmax) для best practices. Пресеты будут основаны на проверенных конфигурациях от профессионалов. На этапе планирования включим research task для сбора оптимальных параметров.

- Q: Как определяем правила валидации для каждого параметра max.ini? → A: Базовая валидация типов данных (int/string/bool/path) + проверка существования путей + расширяемая JSON-схема для специфических правил (диапазоны, regex). Начинаем с разумных базовых проверок, добавляем детальные правила по мере необходимости через validation_rules.json. Agile подход: безопасность с первого дня, расширение по feedback.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Просмотр и редактирование max.ini (Priority: P1)

Пользователь запускает макрос MaxManager INI Editor в 3ds Max (категория MaxManager). Макрос запускает Python скрипт и открывается красивое Qt окно (PySide6) с текущими настройками 3ds Max, сгруппированными по категориям (Рендеринг, Память, Путь к файлам, Интерфейс и т.д.). Он может изменить любой параметр через современные Qt элементы (QLineEdit, QSpinBox, QCheckBox, QComboBox, file picker кнопки) и сохранить изменения. При наведении на параметр появляется QToolTip подсказка на выбранном языке (RU/EN). UI использует темы MaxManager для единого стиля.

**Why this priority**: Это базовая функциональность, без которой фича бессмысленна. Пользователь должен иметь возможность редактировать настройки через GUI вместо ручного редактирования текстового файла.

**Independent Test**: Можно полностью протестировать открыв редактор, изменив любой параметр (например, RenderThreads=8), сохранив и проверив что изменения применились в max.ini. Доставляет ценность: безопасное редактирование max.ini без риска синтаксических ошибок.

**Acceptance Scenarios**:

1. **Given** max.ini существует по стандартному пути, **When** пользователь открывает редактор, **Then** все настройки отображаются с корректными текущими значениями
2. **Given** редактор открыт, **When** пользователь изменяет параметр и нажимает "Сохранить", **Then** изменения записываются в max.ini и создаётся резервная копия с timestamp
3. **Given** пользователь наводит на параметр, **When** курсор задерживается > 1 сек, **Then** появляется всплывающая подсказка на выбранном языке
4. **Given** пользователь вводит некорректное значение (например, текст вместо числа), **When** пытается сохранить, **Then** показывается ошибка валидации с указанием проблемы

---

### User Story 2 - Применение готовых пресетов (Priority: P2)

Пользователь выбирает один из предустановленных пресетов (например, "High Performance", "Memory Optimized", "Arnold Renderer", "V-Ray Production") из выпадающего списка и применяет его одним кликом. Все связанные параметры изменяются автоматически. Перед применением показывается превью изменений.

**Why this priority**: Пресеты - ключевая ценность фичи. Они позволяют быстро настроить 3ds Max для конкретной задачи без знания всех технических деталей max.ini.

**Independent Test**: Можно протестировать выбрав пресет "High Performance", просмотрев превью изменений и применив его. Проверить что все параметры пресета записались в max.ini. Доставляет ценность: настройка 3ds Max за < 30 секунд vs 30+ минут ручной настройки.

**Acceptance Scenarios**:

1. **Given** редактор открыт, **When** пользователь выбирает пресет из списка, **Then** показывается описание пресета и список параметров которые изменятся
2. **Given** пресет выбран, **When** пользователь нажимает "Применить пресет", **Then** все параметры из пресета записываются в max.ini (с бэкапом) и показывается уведомление об успехе
3. **Given** в max.ini есть пользовательские настройки, **When** применяется пресет, **Then** показывается предупреждение о перезаписи текущих значений с возможностью отмены
4. **Given** пресет применён, **When** пользователь закрывает редактор, **Then** изменения сохранены и отображаются при следующем открытии

---

### User Story 3 - Создание и сохранение пользовательских пресетов (Priority: P3)

Пользователь настраивает параметры max.ini по своему вкусу, даёт пресету имя и описание, и сохраняет его как пользовательский пресет. В дальнейшем он может применять этот пресет или поделиться им с коллегами (экспорт JSON файла). Пользовательские пресеты хранятся отдельно от встроенных.

**Why this priority**: Позволяет создавать персонализированные конфигурации и делиться ими в команде. Повышает гибкость инструмента но не критично для MVP.

**Independent Test**: Можно протестировать настроив несколько параметров, сохранив как "My Custom Preset", закрыв редактор, снова открыв и проверив что пресет доступен в списке пользовательских. Доставляет ценность: переиспользование конфигураций между проектами/машинами.

**Acceptance Scenarios**:

1. **Given** пользователь изменил настройки, **When** нажимает "Сохранить как пресет", **Then** открывается диалог с полями "Имя", "Описание" и кнопками "Сохранить"/"Отменить"
2. **Given** диалог сохранения открыт, **When** пользователь вводит имя и сохраняет, **Then** пресет появляется в разделе "Мои пресеты" и сохраняется в `~/.maxmanager/presets/[preset_name].json`
3. **Given** пользовательский пресет создан, **When** пользователь выбирает "Экспорт", **Then** сохраняется JSON файл который можно импортировать на другой машине
4. **Given** пользовательский пресет выбран, **When** пользователь нажимает "Удалить", **Then** показывается подтверждение и при согласии пресет удаляется

---

### User Story 4 - Мультиязычные подсказки (Priority: P4)

Пользователь переключает язык интерфейса между русским и английским. Все подсказки, описания параметров и пресетов отображаются на выбранном языке. Язык сохраняется в настройках MaxManager.

**Why this priority**: Улучшает UX для русскоязычных пользователей но функционально не критично - базовая функциональность работает и на английском.

**Independent Test**: Можно протестировать переключив язык на русский и проверив что все подсказки отображаются на русском, затем переключив на английский. Доставляет ценность: доступность для пользователей с разным уровнем английского.

**Acceptance Scenarios**:

1. **Given** редактор открыт, **When** пользователь переключает язык в настройках, **Then** все подсказки и описания мгновенно меняются на выбранный язык
2. **Given** язык изменён, **When** пользователь закрывает и снова открывает редактор, **Then** язык остаётся выбранным (сохранён в конфиге)
3. **Given** для параметра нет перевода, **When** пользователь наводит на него, **Then** показывается английская версия с пометкой "[EN]"

---

### Edge Cases

- **Что происходит когда max.ini не существует?** Редактор создаёт новый max.ini с настройками по умолчанию и уведомляет пользователя
- **Что если max.ini повреждён или имеет неожиданный формат?** Показывается ошибка с предложением восстановить из последнего бэкапа или создать новый файл
- **Что если у пользователя несколько версий 3ds Max установлено?** Редактор определяет все установленные версии и позволяет выбрать какую настраивать
- **Что если файл max.ini заблокирован другим процессом?** Показывается ошибка "Файл используется другим приложением. Закройте 3ds Max и попробуйте снова"
- **Что если пресет содержит устаревшие параметры?** Применяются только существующие параметры, устаревшие игнорируются с предупреждением в логе
- **Что если размер max.ini > 10MB?** Показывается предупреждение о большом файле и предлагается открыть в текстовом редакторе
- **Что если у пользователя нет прав на запись в папку 3ds Max?** Показывается ошибка с предложением запустить MaxManager от администратора

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система ДОЛЖНА автоматически определять путь к max.ini для установленных версий 3ds Max (2020-2025)
- **FR-002**: Система ДОЛЖНА парсить max.ini файл и извлекать все параметры с их значениями
- **FR-003**: Система ДОЛЖНА группировать параметры по категориям (Rendering, Memory, Paths, UI, Plugins, Network Rendering, Performance)
- **FR-004**: Система ДОЛЖНА отображать параметры через соответствующие UI элементы (текст/число/bool/путь)
- **FR-005**: Система ДОЛЖНА валидировать значения параметров перед сохранением (базовая валидация типов: int/string/bool/path + проверка существования путей + расширяемые правила через validation_rules.json)
- **FR-006**: Система ДОЛЖНА создавать резервную копию max.ini перед каждым сохранением с timestamp (формат: `max.ini.backup.YYYYMMDD_HHMMSS`)
- **FR-007**: Система ДОЛЖНА хранить максимум 10 последних бэкапов, автоматически удаляя старые
- **FR-008**: Пользователь ДОЛЖЕН иметь возможность восстановить max.ini из любого бэкапа
- **FR-009**: Система ДОЛЖНА показывать подсказки для каждого параметра на русском и английском языках
- **FR-010**: Система ДОЛЖНА включать минимум 5 предустановленных пресетов (High Performance, Memory Optimized, Arnold Optimized, V-Ray Optimized, Minimal)
- **FR-011**: Пользователь ДОЛЖЕН иметь возможность создавать, редактировать, удалять и экспортировать пользовательские пресеты
- **FR-012**: Система ДОЛЖНА показывать превью изменений перед применением пресета
- **FR-013**: Пользовательские пресеты ДОЛЖНЫ сохраняться в формате JSON в `~/.maxmanager/presets/`
- **FR-014**: Система ДОЛЖНА поддерживать импорт пресетов из JSON файлов
- **FR-015**: Система ДОЛЖНА логировать все изменения max.ini с timestamp и описанием действия
- **FR-016**: Интерфейс ДОЛЖЕН поддерживать переключение между русским и английским языками
- **FR-017**: Система ДОЛЖНА сохранять выбранный язык в конфигурации MaxManager
- **FR-018**: Система ДОЛЖНА обрабатывать ошибки чтения/записи max.ini с понятными сообщениями пользователю
- **FR-019**: Система ДОЛЖНА поддерживать поиск параметров по имени и описанию
- **FR-020**: Система ДОЛЖНА показывать индикатор "несохранённых изменений" при редактировании
- **FR-021**: Встроенные пресеты ДОЛЖНЫ быть основаны на best practices из документации Autodesk и проверенных конфигураций community (research task на этапе планирования)

### Key Entities

- **MaxINIParameter**: Представляет отдельный параметр в max.ini. Атрибуты: имя (ключ), значение, тип (string/int/bool/path), категория, описание_RU, описание_EN, валидация (опционально: min/max/regex)
- **MaxINIPreset**: Представляет пресет настроек. Атрибуты: имя, описание_RU, описание_EN, автор (built-in/user), параметры (список MaxINIParameter), теги (например: renderer, performance, memory)
- **MaxINIBackup**: Представляет резервную копию файла. Атрибуты: timestamp, путь к файлу, размер, хеш (для проверки целостности)
- **Max3dsVersion**: Представляет установленную версию 3ds Max. Атрибуты: год (2020-2025), путь к max.ini, битность (64bit), язык (ENU/RUS/etc)

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Пользователь может отредактировать любой параметр max.ini и сохранить изменения менее чем за 5 минут (vs 15+ минут ручного редактирования)
- **SC-002**: Система обеспечивает 0 случаев повреждения max.ini благодаря валидации и бэкапам
- **SC-003**: Применение пресета занимает менее 30 секунд (vs 30+ минут ручной настройки)
- **SC-004**: 90% пользователей успешно применяют пресет с первой попытки без обращения к документации
- **SC-005**: Сокращение времени настройки 3ds Max для нового проекта на 70%
- **SC-006**: Редактор поддерживает работу с max.ini файлами размером до 5MB без задержек > 2 секунд
- **SC-007**: Все подсказки доступны на русском и английском языках для 100% параметров
- **SC-008**: Пользователь может восстановить max.ini из бэкапа за < 1 минуту

## Assumptions

- 3ds Max установлен в стандартные пути (определяемые через реестр Windows или переменные окружения)
- Пользователь имеет права на чтение/запись в папку `%APPDATA%/Local/Autodesk/3dsMax/`
- max.ini имеет стандартный INI формат (секции [Section], параметры Key=Value)
- Пользователь работает под Windows (3ds Max не поддерживает другие ОС)
- MaxManager уже установлен и настроен
- Пользователь знаком с базовыми концепциями 3ds Max (рендеринг, память, плагины)

## Out of Scope

- Автоматическая оптимизация параметров на основе анализа системы (будет в будущих версиях)
- Синхронизация настроек между машинами через облако (будет отдельная фича)
- Редактирование других конфигурационных файлов 3ds Max (plugin.ini, etc)
- Создание пресетов на основе AI рекомендаций (будет в будущих версиях)
- Поддержка 3ds Max версий старше 2020 (устаревшие версии)
- Мобильное приложение для удалённого управления настройками

## Dependencies

### Technical
- PySide6 для GUI (встроен в 3ds Max 2025, используется через qtmax module)
- Модуль Python configparser для парсинга INI файлов (стандартная библиотека)
- Модуль Python winreg для определения установленных версий 3ds Max через реестр Windows
- Существующий модуль MaxManager config для сохранения пользовательских настроек
- Существующий модуль MaxManager logger для логирования изменений

### Data & Configuration
- validation_rules.json - расширяемая схема валидации параметров
- preset_library.json - встроенные пресеты (High Performance, Memory Optimized, Arnold, V-Ray, Minimal)
- translations.json - подсказки и описания на RU/EN

### Research & Content (на этапе планирования)
- Research task: сбор best practices для пресетов из Autodesk docs + community (CGSociety, forums, Reddit)
- Research task: документация max.ini параметров для категоризации и подсказок
