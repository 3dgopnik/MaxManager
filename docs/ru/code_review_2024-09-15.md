# Отчёт по ревью кода (MaxManager)

## Цель
Зафиксировать обнаруженные в ходе первичного ревью проблемы и предложить направления для исправлений без внесения изменений в исходный код.

## Найденные проблемы и рекомендации

1. **Неверная инициализация менеджера бэкапов**  
   `INIManager` создаёт `MaxINIBackupManager`, передавая путь до папки, хотя конструктор принимает только количество бэкапов. Это приведёт к `TypeError` при сравнении в `cleanup_old_backups` и не создаст выделенную директорию для копий. Рекомендуется расширить `MaxINIBackupManager`, чтобы он принимал путь к каталогу бэкапов, создавать папку при необходимости и использовать её при формировании путей сохранения.【F:src/modules/ini_manager.py†L33-L38】【F:src/modules/maxini_backup.py†L25-L190】

2. **Потеря регистра ключей INI-файла**  
   `MaxINIParser` использует `configparser.ConfigParser()` с настройкой по умолчанию. В таком режиме регистр ключей затирается, и все ключи становятся строчными. Это ломает поиск параметров в UI и может повредить файл при сохранении. Следует выставить `config.optionxform = str` и при записи также использовать ConfigParser с отключённой нормализацией.【F:src/modules/maxini_parser.py†L101-L142】【F:src/modules/maxini_parser.py†L186-L205】

3. **Перезапись только исходных параметров**  
   При сохранении `INIManager` итерируется по списку `original_parameters`, поэтому новые параметры, добавленные пользователем, не попадут в итоговый файл, а удалённые значения вернутся обратно. Нужен режим синхронизации по текущему состоянию `current_sections`, чтобы учитывать добавления и удаления ключей при записи.【F:src/modules/ini_manager.py†L225-L258】

4. **Дублирующиеся реализации ModuleManager и отсутствующий логгер**  
   В `module_manager.py` находится два определения класса `ModuleManager`, причём оба зависят от `core.logger`, которого нет в дереве проекта. Это создаёт неоднозначность API и вызывает `ModuleNotFoundError`. Рекомендуется оставить одну консистентную реализацию, перенести её в отдельный модуль и заменить зависимость на существующую систему логирования (или добавить недостающий пакет).【F:src/modules/module_manager.py†L1-L200】

5. **Неверный путь к логгеру в FileManager**  
   `file_manager.py` импортирует `get_logger` из `..core.logger`, но пакета `core` нет. Нужно использовать реальный путь к логгеру (либо внедрить его) и покрыть модуль тестом инициализации, чтобы подобные ошибки ловились автоматически.【F:src/modules/file_manager.py†L6-L194】

## Предложенные шаги
- Добавить поддержку пользовательской директории бэкапов и настроить очистку старых копий.
- Настроить ConfigParser на сохранение регистра ключей при чтении/записи.
- Переписать сохранение INI-файла с учётом фактического состояния текущих секций.
- Разделить ответственность `ModuleManager` и привести его к рабочей конфигурации логирования.
- Исправить импорты логгера в файловом менеджере и добавить проверочные тесты.

