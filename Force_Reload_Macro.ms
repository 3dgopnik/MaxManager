/*
 * Force Reload MaxINI Editor Macro
 * Description: Forces 3ds Max to reload the updated macro
 */

try (
    clearListener()
    format "\n=== FORCE RELOAD MaxINI Editor Macro ===\n\n"
    
    -- Unregister old macro first
    format "ğŸ—‘ï¸ Unregistering old macro...\n"
    try (
        unregisterMacroScript "MaxManager" "MaxManager_INIEditor"
        format "âœ… Old macro unregistered\n"
    ) catch (
        format "âš ï¸ Old macro not found (OK)\n"
    )
    
    -- Force reload from file
    local macroPath = (getdir #maxdata) + "UI\\macroscripts\\MaxManager_INIEditor.mcr"
    format "ğŸ”„ Reloading macro from: %\n" macroPath
    
    if doesFileExist macroPath then (
        fileIn macroPath
        format "âœ… Macro reloaded successfully\n"
    ) else (
        format "âŒ ERROR: Macro file not found: %\n" macroPath
        throw "Reload failed"
    )
    
    -- Verify registration
    format "ğŸ” Verifying macro registration...\n"
    if (macroScriptExists "MaxManager" "MaxManager_INIEditor") then (
        format "âœ… Macro registered: MaxManager - MaxManager_INIEditor\n"
    ) else (
        format "âŒ ERROR: Macro not registered!\n"
        throw "Registration failed"
    )
    
    format "\n=== FORCE RELOAD COMPLETE! ===\n"
    format "ğŸ¯ Macro updated to v1.0.0 (Advanced Editor priority)\n"
    format "ğŸ“‹ Next: Click MaxINI Editor button to launch Advanced Editor v1.0.0\n\n"
    
    messageBox "FORCE RELOAD COMPLETE!\n\nğŸ¯ Macro updated to v1.0.0\nğŸ”§ Advanced Editor is now PRIMARY\nğŸ“‹ Click MaxINI Editor button to test!" title:"Force Reload Complete" beep:false
    
) catch (
    local errorMsg = getCurrentException()
    format "\nâŒ FORCE RELOAD FAILED: %\n" errorMsg
    messageBox ("FORCE RELOAD FAILED!\n\n" + errorMsg) title:"Force Reload Error"
)
