<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MaxManager - Parameter Enricher</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            background: #1e1e1e;
            color: #fff;
            padding: 20px;
        }
        .header {
            background: #2d2d30;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .param-list {
            background: #2d2d30;
            padding: 20px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
        .param-item {
            padding: 10px;
            margin: 5px 0;
            background: #3e3e42;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .param-item:hover {
            background: #4ec9b0;
            color: #000;
        }
        .param-item.selected {
            background: #569cd6;
            color: #000;
        }
        .param-item.enriched {
            border-left: 4px solid #6a9955;
        }
        .param-item.needs-work {
            border-left: 4px solid #f48771;
        }
        .editor {
            background: #2d2d30;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            background: #1e1e1e;
            color: #fff;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Consolas', monospace;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-save { background: #4ec9b0; color: #000; }
        .btn-skip { background: #ce9178; color: #000; }
        .btn-search { background: #569cd6; color: #000; }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #1e1e1e;
            color: #fff;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            margin: 5px 0;
        }
        .search-results {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin: 20px 0;
        }
        .stat-box {
            background: #3e3e42;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #4ec9b0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ†Ô∏è Parameter Enricher Tool</h1>
        <p>–ë—ã—Å—Ç—Ä–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –±–∞–∑—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</p>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="total">844</div>
                <div>–í—Å–µ–≥–æ</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="enriched">0</div>
                <div>–û–±–æ–≥–∞—â–µ–Ω–æ</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="remaining">844</div>
                <div>–û—Å—Ç–∞–ª–æ—Å—å</div>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
        <div class="param-list">
            <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
            <input type="text" id="searchFilter" placeholder="üîç –ü–æ–∏—Å–∫..." onkeyup="filterParams()">
            <div id="paramList"></div>
        </div>

        <div class="editor">
            <h3 id="currentParam">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä</h3>
            
            <div style="margin: 20px 0;">
                <button class="btn-search" onclick="searchAutodesk()">üîç Autodesk Help</button>
                <button class="btn-search" onclick="searchForum()">üí¨ Forums</button>
                <button class="btn-search" onclick="searchGoogle()">üåê Google</button>
            </div>

            <div id="searchResults" class="search-results" style="display: none;"></div>

            <div style="margin-top: 20px;">
                <label><strong>Description EN:</strong></label>
                <textarea id="descEN" rows="3"></textarea>
                
                <label><strong>Description RU:</strong></label>
                <textarea id="descRU" rows="3"></textarea>
                
                <label><strong>Recommendation EN:</strong></label>
                <textarea id="recEN" rows="4"></textarea>
                
                <label><strong>Recommendation RU:</strong></label>
                <textarea id="recRU" rows="4"></textarea>
                
                <label><strong>Introduced in version:</strong></label>
                <input type="text" id="version" placeholder="2024, 2015, unknown">
                
                <label><strong>Source URL:</strong></label>
                <input type="text" id="sourceUrl" placeholder="https://...">
            </div>

            <div style="margin-top: 20px;">
                <button class="btn-save" onclick="saveParameter()">üíæ Save & Next</button>
                <button class="btn-skip" onclick="skipParameter()">‚è≠Ô∏è Skip</button>
            </div>
        </div>
    </div>

    <script>
        let database = null;
        let currentParam = null;
        let paramIndex = 0;

        async function loadDatabase() {
            try {
                const resp = await fetch('../docs/maxini_ultimate_master_v2.json');
                database = await resp.json();
            
                const params = Object.keys(database).filter(k => k !== '_metadata');
                renderParamList(params);
                updateStats();
            } catch (e) {
                alert('Error loading database: ' + e.message);
                console.error(e);
            }
        }

        function renderParamList(params) {
            const list = document.getElementById('paramList');
            list.innerHTML = '';
            
            params.forEach((name, idx) => {
                const param = database[name];
                const div = document.createElement('div');
                div.className = 'param-item';
                
                const hasDesc = param.en?.description && param.en.description.length > 50;
                const hasRec = param.recommended?.en && param.recommended.en.length > 50;
                
                if (hasDesc && hasRec) {
                    div.classList.add('enriched');
                } else {
                    div.classList.add('needs-work');
                }
                
                div.textContent = name;
                div.onclick = () => selectParameter(name, idx);
                list.appendChild(div);
            });
        }

        function selectParameter(name, idx) {
            currentParam = name;
            paramIndex = idx;
            
            // Highlight
            document.querySelectorAll('.param-item').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // Load data
            const param = database[name];
            document.getElementById('currentParam').textContent = name;
            document.getElementById('descEN').value = param.en?.description || '';
            document.getElementById('descRU').value = param.ru?.description || '';
            document.getElementById('recEN').value = param.recommended?.en || '';
            document.getElementById('recRU').value = param.recommended?.ru || '';
            document.getElementById('version').value = param.introduced_in || '';
            document.getElementById('sourceUrl').value = param.source?.[0] || '';
        }

        function searchAutodesk() {
            const query = `site:help.autodesk.com 3ds Max ${currentParam}`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }

        function searchForum() {
            const query = `site:forums.autodesk.com ${currentParam}`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }

        function searchGoogle() {
            const query = `3ds Max ${currentParam} ini setting`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }

        function saveParameter() {
            if (!currentParam) return;
            
            const param = database[currentParam];
            param.en.description = document.getElementById('descEN').value;
            param.ru.description = document.getElementById('descRU').value;
            param.recommended.en = document.getElementById('recEN').value;
            param.recommended.ru = document.getElementById('recRU').value;
            param.introduced_in = document.getElementById('version').value || null;
            
            const sourceUrl = document.getElementById('sourceUrl').value;
            if (sourceUrl && !param.source.includes(sourceUrl)) {
                param.source.push(sourceUrl);
            }
            
            // Save to localStorage (temp)
            localStorage.setItem('enriched_db', JSON.stringify(database));
            
            alert('Saved! Export database when done.');
            skipParameter();
        }

        function skipParameter() {
            // Next parameter
            const params = Object.keys(database).filter(k => k !== '_metadata');
            paramIndex = (paramIndex + 1) % params.length;
            selectParameter(params[paramIndex], paramIndex);
        }

        function filterParams() {
            const query = document.getElementById('searchFilter').value.toLowerCase();
            const params = Object.keys(database).filter(k => k !== '_metadata');
            const filtered = query ? params.filter(p => p.toLowerCase().includes(query)) : params;
            renderParamList(filtered);
        }

        function updateStats() {
            const params = Object.keys(database).filter(k => k !== '_metadata');
            const enriched = params.filter(k => {
                const p = database[k];
                const hasDesc = p.en?.description && p.en.description.length > 50;
                const hasRec = p.recommended?.en && p.recommended.en.length > 50;
                return hasDesc && hasRec;
            });
            
            document.getElementById('total').textContent = params.length;
            document.getElementById('enriched').textContent = enriched.length;
            document.getElementById('remaining').textContent = params.length - enriched.length;
        }

        function exportDatabase() {
            const json = JSON.stringify(database, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'maxini_ultimate_master_v2_enriched.json';
            a.click();
        }

        loadDatabase();
    </script>
</body>
</html>

